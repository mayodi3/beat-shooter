<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register</title>
  <style>
    body {
      background: black;
      color: white;
    }

    form {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }

    input {
      background: transparent;
      color: white;
      height: 4vh;
      width: 50vw;
    }

    div {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    button {
      margin-top: 10px;
      height: 5vh;
      width: 52vw;
      font-weight: bolder;
    }

    .login,
    .forgot-password {
      display: none;
    }
  </style>
</head>

<body>
  <div class="register" id="registerForm">
    <h1>Create new</h1>
    <h1>Account</h1>
    <p>Already a user? <a href="#" id="loginLink">Login here</a></p>
    <form id="registrationForm">
      <label for="username">NAME</label>
      <input required placeholder="enter your username here" type="text" name="username" id="username-register" />
      <label for="email">EMAIL</label>
      <input required placeholder="example@gmail.com" type="email" name="email" id="email-register" />
      <label for="password">PASSWORD</label>
      <input required placeholder="your preferred password" type="password" name="password" id="password-register" />
      <label for="DOB">DATE OF BIRTH</label>
      <input required type="date" name="DOB" id="DOB-register" />
      <button type="submit" id="register">sign up</button>
      <p id="signUpMessage"></p>
    </form>
  </div>
  <div class="login" id="loginForm">
    <h1>Login</h1>
    <p>Sign in to continue</p>
    <form id="loginForm">
      <label for="email">EMAIL</label>
      <input placeholder="example@gmail.com" type="email" name="email" id="email-login" />
      <label for="password">PASSWORD</label>
      <input placeholder="enter your password to sign in" type="password" name="password" id="password-login" />
      <button type="submit" id="login">log In</button>
      <p><a href="#" id="forgotPasswordLink">Forgot password?</a></p>
      <p>New User?<a href="#" id="registerLink">Sign Up</a></p>
      <p id="loginMessage"></p>
    </form>
  </div>
  <div class="forgot-password" id="forgotPasswordForm">
    <h1>Reset Password</h1>
    <p>Enter your email to reset your password</p>
    <form id="resetForm">
      <label for="email">EMAIL</label>
      <input placeholder="example@gmail.com" type="email" name="email" id="email-reset" />
      <button type="submit" id="reset">Reset Password</button>
      <p id="resetMessage"></p>
      <p><a href="#" id="backLink">Back to login</a></p>
    </form>
  </div>
  <script type="module" defer>
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-analytics.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword, sendPasswordResetEmail
    } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc
    } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDMbXl3RV7eY7mI-EJrsaBoU3pUQbSl_5g",
      authDomain: "bshoot-d82b3.firebaseapp.com",
      projectId: "bshoot-d82b3",
      storageBucket: "bshoot-d82b3.appspot.com",
      messagingSenderId: "438934160281",
      appId: "1:438934160281:web:b05997bd644243e59dc908",
      measurementId: "G-MMJGVEMTJW",
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth();
    const db = getFirestore(app);

    document.addEventListener('DOMContentLoaded', (event) => {
      // creating new user
      const registrationForm = document.getElementById("registerForm");
      registrationForm.addEventListener("submit", (event) => {
        event.preventDefault();
        const username = document.getElementById("username-register").value;
        const email = document.getElementById("email-register").value;
        const password = document.getElementById("password-register").value;
        const message = document.getElementById("signUpMessage");

        createUserWithEmailAndPassword(auth, email, password)
          .then((userCredential) => {
            const user = userCredential.user;
            const userData = {
              name: username,
              userEmail: email,
              dateCreated: Date.now()
            };
            return setDoc(doc(db, "users", user.uid), userData);
          })
          .then(() => {
            message.style.color = "greenYellow";
            message.innerText = "Signed up successfully!";
            setTimeout(() => {
              registrationForm.style.display = "none";
              loginForm.style.display = "flex";
            }, 500);
          })
          .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            message.style.color = "red";
            message.innerText = "Failed to sign up!";
            console.error(errorCode + " : ", errorMessage);
          });
      });

      // Login a user
      const loginLink = document.getElementById("loginLink")
      const loginForm = document.getElementById("loginForm");
      loginLink.addEventListener("click", (event) => {
        event.preventDefault();
        registrationForm.style.display = "none";
        loginForm.style.display = "flex";
      });
      const registerLink = document.getElementById("registerLink")
      registerLink.addEventListener("click", (event) => {
        event.preventDefault();
        registrationForm.style.display = "flex";
        loginForm.style.display = "none";
      });
      loginForm.addEventListener("submit", (event) => {
        event.preventDefault();
        const email = document.getElementById("email-login").value;
        const password = document.getElementById("password-login").value;
        const message = document.getElementById("loginMessage");

        signInWithEmailAndPassword(auth, email, password)
          .then((userCredential) => {
            message.style.color = "greenYellow";
            message.innerText = "Welcome Back!";
            setTimeout(() => {
              loginForm.style.display = "none";
              window.location.href = "main.html"; // Redirect to the main page after login
            }, 500);
          })
          .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            message.style.color = "red";
            message.innerText = errorMessage;
            console.error(errorCode + " : ", errorMessage);
          });
      });

      // Reseting the password of the user
      const forgotPasswordLink = document.getElementById("forgotPasswordLink");
      const forgotPasswordForm = document.getElementById("forgotPasswordForm");
      forgotPasswordLink.addEventListener("click", (event) => {
        event.preventDefault();
        loginForm.style.display = "none";
        forgotPasswordForm.style.display = "flex";
      });
      const backLink = document.getElementById("backLink")
      backLink.addEventListener("click", (event) => {
        event.preventDefault();
        loginForm.style.display = "flex";
        forgotPasswordForm.style.display = "none";
      });
      const resetForm = document.getElementById("resetForm");
      resetForm.addEventListener("submit", (event) => {
        event.preventDefault();
        const email = document.getElementById("email-reset").value;
        const message = document.getElementById("resetMessage");

        sendPasswordResetEmail(email)
          .then(() => {
            message.style.color = "greenYellow";
            message.innerText = "Password reset email sent!";
          })
          .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            message.style.color = "red";
            message.innerText = "Error sending password reset email.";
            console.error(errorCode + " : ", errorMessage);
          });
      });
    });
  </script>
</body>

</html>